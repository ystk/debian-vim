From: Markus Koschany <apo@debian.org>
Date: Tue, 17 May 2022 14:41:50 +0200
Subject: CVE-2022-0351

Origin: https://github.com/vim/vim/commit/fe6fb267e6ee5c5da2f41889e4e0e0ac5bf4b89d
---
 src/eval.c | 10 ++++++++++
 1 file changed, 10 insertions(+)

diff --git a/src/eval.c b/src/eval.c
index 83fd803..76c5fcc 100644
--- a/src/eval.c
+++ b/src/eval.c
@@ -5034,6 +5034,7 @@ eval7(arg, rettv, evaluate, want_string)
     char_u	*start_leader, *end_leader;
     int		ret = OK;
     char_u	*alias;
+    static	int recurse = 0;
 
     /*
      * Initialise variable so that clear_tv() can't mistake this for a
@@ -5049,6 +5050,14 @@ eval7(arg, rettv, evaluate, want_string)
 	*arg = skipwhite(*arg + 1);
     end_leader = *arg;
 
+    // Limit recursion to 1000 levels.  At least at 10000 we run out of stack
+    // and crash.
+    if (recurse == 1000)
+    {
+      return FAIL;
+    }
+    ++recurse;
+
     switch (**arg)
     {
     /*
@@ -5305,6 +5314,7 @@ eval7(arg, rettv, evaluate, want_string)
 	}
     }
 
+    --recurse;
     return ret;
 }
 
