From: Markus Koschany <apo@debian.org>
Date: Wed, 21 Jun 2022 11:21:15 +0200
Subject: CVE-2022-2124

Origin: https://github.com/vim/vim/commit/2f074f4685897ab7212e25931eeeb0212292829f
---
 src/search.c | 6 ++++++
 1 file changed, 6 insertions(+)

diff --git a/src/search.c b/src/search.c
index c68c702..f192ecc 100644
--- a/src/search.c
+++ b/src/search.c
@@ -4254,11 +4254,17 @@ current_quote(oap, count, include, quotechar)
 
 	/* Find out if we have a quote in the selection. */
 	while (i <= col_end)
+	{
+	    // check for going over the end of the line, which can happen if
+	    // the line was changed after the Visual area was selected.
+	    if (line[i] == NUL)
+		break;
 	    if (line[i++] == quotechar)
 	    {
 		selected_quote = TRUE;
 		break;
 	    }
+	}
     }
 
     if (!vis_empty && line[col_start] == quotechar)
