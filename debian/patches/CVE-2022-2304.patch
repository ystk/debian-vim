From: Markus Koschany <apo@debian.org>
Date: Thu, 10 Nov 2022 17:03:51 +0100
Subject: CVE-2022-2304

Origin: https://github.com/vim/vim/commit/54e5fed6d27b747ff152cdb6edfb72ff60e70939
---
 src/spell.c | 5 +++--
 1 file changed, 3 insertions(+), 2 deletions(-)

diff --git a/src/spell.c b/src/spell.c
index c227b52..091123c 100644
--- a/src/spell.c
+++ b/src/spell.c
@@ -15804,9 +15804,10 @@ spell_dump_compl(pat, ic, dir, dumpflags_arg)
 		    n = arridx[depth] + curi[depth];
 		    ++curi[depth];
 		    c = byts[n];
-		    if (c == 0)
+		    if (c == 0 || depth >= MAXWLEN - 1)
 		    {
-			/* End of word, deal with the word.
+			/* End of word or reached maximum length, deal with the
+			 * word.
 			 * Don't use keep-case words in the fold-case tree,
 			 * they will appear in the keep-case tree.
 			 * Only use the word when the region matches. */
