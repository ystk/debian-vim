From: Markus Koschany <apo@debian.org>
Date: Wed, 21 Jun 2022 11:19:48 +0200
Subject: CVE-2022-1851

Origin: https://github.com/vim/vim/commit/78d52883e10d71f23ab72a3d8b9733b00da8c9ad
---
 src/ops.c | 3 +++
 1 file changed, 3 insertions(+)

--- a/src/ops.c
+++ b/src/ops.c
@@ -4728,6 +4728,9 @@ op_format(oap, keep_cursor)
     {
 	curwin->w_cursor = saved_cursor;
 	saved_cursor.lnum = 0;
+
+    // formatting may have made the cursor position invalid
+    check_cursor();
     }
 
     if (oap->is_VIsual)
