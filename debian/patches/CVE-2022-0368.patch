From: Markus Koschany <apo@debian.org>
Date: Sat, 12 Mar 2022 10:17:59 +0100
Subject: CVE-2022-0368

Origin: https://github.com/vim/vim/commit/8d02ce1ed75d008c34a5c9aaa51b67cbb9d33baa
---
 src/undo.c | 2 ++
 1 file changed, 2 insertions(+)

diff --git a/src/undo.c b/src/undo.c
index 28ccced..980f84f 100644
--- a/src/undo.c
+++ b/src/undo.c
@@ -3000,6 +3000,8 @@ u_undo_end(did_undo, absolute)
 	}
     }
 #endif
+    if (VIsual_active)
+	check_pos(curbuf, &VIsual);
 
     smsg((char_u *)_("%ld %s; %s #%ld  %s"),
 	    u_oldcount < 0 ? -u_oldcount : u_oldcount,
