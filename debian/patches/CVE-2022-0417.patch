From: Markus Koschany <apo@debian.org>
Date: Wed, 21 Jun 2022 11:12:40 +0200
Subject: CVE-2022-0417

Origin: https://github.com/vim/vim/commit/652dee448618589de5528a9e9a36995803f5557a
---
 src/option.c | 5 +++++
 src/vim.h    | 2 ++
 2 files changed, 7 insertions(+)

--- a/src/option.c
+++ b/src/option.c
@@ -8683,6 +8683,11 @@ set_num_option(opt_idx, varp, value, err
 	errmsg = e_positive;
 	curbuf->b_p_ts = 8;
     }
+    else if (curbuf->b_p_ts > TABSTOP_MAX)
+    {
+	errmsg = e_invarg;
+	curbuf->b_p_ts = 8;
+    }
     if (p_tm < 0)
     {
 	errmsg = e_positive;
--- a/src/vim.h
+++ b/src/vim.h
@@ -1892,6 +1892,8 @@ typedef int proftime_T;	    /* dummy for
 #define VV_PROGPATH	57
 #define VV_LEN		58	/* number of v: vars */
 
+#define TABSTOP_MAX 9999
+
 #ifdef FEAT_CLIPBOARD
 
 /* VIM_ATOM_NAME is the older Vim-specific selection type for X11.  Still
