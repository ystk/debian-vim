From: Markus Koschany <apo@debian.org>
Date: Sat, 12 Mar 2022 11:01:57 +0100
Subject: CVE-2021-3778

Origin: https://github.com/vim/vim/commit/65b605665997fad54ef39a93199e305af2fe4d7f
---
 src/regexp_nfa.c | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

--- a/src/regexp_nfa.c
+++ b/src/regexp_nfa.c
@@ -5346,7 +5346,8 @@ find_match_text(startcol, regstart, matc
 		match = FALSE;
 		break;
 	    }
-	    len2 += MB_CHAR2LEN(c2);
+    	len2 += enc_utf8 ? utf_ptr2len(regline + col + len2)
+							     : MB_CHAR2LEN(c2);
 	}
 	if (match
 #ifdef FEAT_MBYTE
